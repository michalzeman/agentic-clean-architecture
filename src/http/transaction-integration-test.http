### Bank Transaction Integration Test - Basic Demo
### This file demonstrates the basic transaction creation and retrieval flow

### Base URLs for local development
@accountBaseUrl = http://localhost:8080/api/v1/accounts
@transactionBaseUrl = http://localhost:8081/api/v1/transactions


### ==================== Setup: Create Test Accounts ====================

### Create source account for bank transactions
# @name createSourceAccount
POST {{accountBaseUrl}}
Content-Type: application/json

{
  "email": "demo-source-{{$timestamp}}@example.com",
  "initialBalance": 5000.00
}

> {%
    client.global.set("sourceAccountId", response.body.accountId);
    client.test("Source account created", function() {
        client.assert(response.status === 201, "Response status is not 201");
        client.assert(response.body.balance === 5000.00, "Initial balance should be 5000");
    });
%}

### Create destination account for bank transactions
# @name createDestAccount
POST {{accountBaseUrl}}
Content-Type: application/json

{
  "email": "demo-dest-{{$timestamp}}@example.com",
  "initialBalance": 1000.00
}

> {%
    client.global.set("destAccountId", response.body.accountId);
    client.test("Destination account created", function() {
        client.assert(response.status === 201, "Response status is not 201");
        client.assert(response.body.balance === 1000.00, "Initial balance should be 1000");
    });
%}


### ==================== Basic Transaction Demo ====================

### Step 1: Create a new bank transaction
# @name createTransaction
POST {{transactionBaseUrl}}
Content-Type: application/json

{
  "fromAccountId": "{{sourceAccountId}}",
  "toAccountId": "{{destAccountId}}",
  "amount": 500.00
}

> {%
    client.global.set("transactionId", response.body.transactionId);
    client.global.set("correlationId", response.body.correlationId);
    client.test("Transaction created", function() {
        client.assert(response.status === 201, "Response status is not 201");
        client.assert(response.body.status === "CREATED", "Transaction status is not CREATED");
        client.assert(response.body.amount === 500.00, "Amount should be 500");
        client.assert(response.body.fromAccountId === client.global.get("sourceAccountId"));
        client.assert(response.body.toAccountId === client.global.get("destAccountId"));
    });
%}

### Step 2: Get bank transaction details to verify creation
GET {{transactionBaseUrl}}/{{transactionId}}
Content-Type: application/json

> {%
    client.test("Transaction retrieved after creation", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.transactionId === client.global.get("transactionId"));
        client.assert(response.body.amount === 500.00);
    });
%}


### ==================== Verify Account Details ====================

### Get source account details
GET {{accountBaseUrl}}/{{sourceAccountId}}
Content-Type: application/json

> {%
    client.test("Source account details retrieved", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.accountId === client.global.get("sourceAccountId"));
    });
%}

### Get destination account details
GET {{accountBaseUrl}}/{{destAccountId}}
Content-Type: application/json

> {%
    client.test("Destination account details retrieved", function() {
        client.assert(response.status === 200, "Response status is not 200");
        client.assert(response.body.accountId === client.global.get("destAccountId"));
    });
%}

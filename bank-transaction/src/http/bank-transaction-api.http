### Bank Transaction REST API Tests
### Base URL for local development
@baseUrl = http://localhost:8081/api/v1/transactions


### ==================== Create Bank Transaction ====================

### Create a bank transaction
# @name createTransaction
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-source-001",
  "toAccountId": "acc-dest-001",
  "amount": 500.00
}

> {%
    client.global.set("transactionId", response.body.transactionId);
    client.global.set("correlationId", response.body.correlationId);
    client.global.set("fromAccountId", response.body.fromAccountId);
    client.global.set("toAccountId", response.body.toAccountId);
%}


### ==================== Get Bank Transaction ====================

### Get bank transaction by ID
GET {{baseUrl}}/{{transactionId}}
Content-Type: application/json

### Get non-existent bank transaction (404)
GET {{baseUrl}}/00000000-0000-0000-0000-000000000000
Content-Type: application/json


### ==================== Bank Transaction Lifecycle ====================

### Step 1: Validate withdraw
POST {{baseUrl}}/{{transactionId}}/validate-withdraw
Content-Type: application/json

{
  "accountId": "{{fromAccountId}}",
  "transactionId": "{{correlationId}}"
}

### Step 2: Validate deposit (auto-finishes the transaction)
POST {{baseUrl}}/{{transactionId}}/validate-deposit
Content-Type: application/json

{
  "accountId": "{{toAccountId}}",
  "transactionId": "{{correlationId}}"
}

### Verify final state (should be FINISHED)
GET {{baseUrl}}/{{transactionId}}
Content-Type: application/json


### ==================== Cancel Bank Transaction ====================

### Create bank transaction to cancel
# @name createCancelTransaction
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-cancel-source",
  "toAccountId": "acc-cancel-dest",
  "amount": 300.00
}

> {%
    client.global.set("cancelTxnId", response.body.transactionId);
    client.global.set("cancelCorrId", response.body.correlationId);
    client.global.set("cancelFromAccountId", response.body.fromAccountId);
    client.global.set("cancelToAccountId", response.body.toAccountId);
%}

### Validate withdraw
POST {{baseUrl}}/{{cancelTxnId}}/validate-withdraw
Content-Type: application/json

{
  "accountId": "{{cancelFromAccountId}}",
  "transactionId": "{{cancelCorrId}}"
}

### Validate deposit
POST {{baseUrl}}/{{cancelTxnId}}/validate-deposit
Content-Type: application/json

{
  "accountId": "{{cancelToAccountId}}",
  "transactionId": "{{cancelCorrId}}"
}

### Cancel bank transaction
POST {{baseUrl}}/{{cancelTxnId}}/cancel
Content-Type: application/json

{
  "fromAccountId": "{{cancelFromAccountId}}",
  "toAccountId": "{{cancelToAccountId}}",
  "amount": 300.00
}

### Verify cancelled state
GET {{baseUrl}}/{{cancelTxnId}}
Content-Type: application/json


### ==================== Error Cases ====================

### Negative amount (400)
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-001",
  "toAccountId": "acc-002",
  "amount": -100.00
}

### Zero amount (400)
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-001",
  "toAccountId": "acc-002",
  "amount": 0.00
}

### Same accounts (400)
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-001",
  "toAccountId": "acc-001",
  "amount": 100.00
}

### Deposit before withdraw (still works, transaction auto-finishes)
# @name createEarlyDepositTxn
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-early-001",
  "toAccountId": "acc-early-002",
  "amount": 100.00
}

> {%
    client.global.set("earlyDepositTxnId", response.body.transactionId);
    client.global.set("earlyDepositCorrId", response.body.correlationId);
    client.global.set("earlyDepositFromAccountId", response.body.fromAccountId);
%}

### Validate deposit first
POST {{baseUrl}}/{{earlyDepositTxnId}}/validate-deposit
Content-Type: application/json

{
  "accountId": "acc-early-002",
  "transactionId": "{{earlyDepositCorrId}}"
}

### Validate withdraw second (auto-finishes the transaction)
POST {{baseUrl}}/{{earlyDepositTxnId}}/validate-withdraw
Content-Type: application/json

{
  "accountId": "{{earlyDepositFromAccountId}}",
  "transactionId": "{{earlyDepositCorrId}}"
}

### Verify transaction is FINISHED
GET {{baseUrl}}/{{earlyDepositTxnId}}
Content-Type: application/json

### Try to validate again on finished transaction (409)
POST {{baseUrl}}/{{earlyDepositTxnId}}/validate-withdraw
Content-Type: application/json

{
  "accountId": "{{earlyDepositFromAccountId}}",
  "transactionId": "{{earlyDepositCorrId}}"
}


### ==================== Validation Error Cases ====================

### Create transaction for validation testing
# @name createValidationTest
POST {{baseUrl}}
Content-Type: application/json

{
  "fromAccountId": "acc-validation-source",
  "toAccountId": "acc-validation-dest",
  "amount": 200.00
}

> {%
    client.global.set("validationTxnId", response.body.transactionId);
    client.global.set("validationCorrId", response.body.correlationId);
    client.global.set("validationFromAccountId", response.body.fromAccountId);
%}

### Try to validate withdraw with wrong accountId (400)
POST {{baseUrl}}/{{validationTxnId}}/validate-withdraw
Content-Type: application/json

{
  "accountId": "wrong-account-id",
  "transactionId": "{{validationCorrId}}"
}

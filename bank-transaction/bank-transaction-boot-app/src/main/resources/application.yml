management:
  endpoints:
    web:
      exposure:
        include: health,info
  health:
    db:
      enabled: false

spring:
  profiles:
    active: redis-persistence

  application:
    name: bank-transaction-service

  data:
    redis:
      host: ${REDIS_DB:localhost}
      port: 6379
      database: 0

  # PostgreSQL datasource for message channel persistence
  datasource:
    url: jdbc:postgresql://${POSTGRES_DB:localhost}:5432/bank_db
    username: ${POSTGRES_USER:bank_user}
    password: ${POSTGRES_PASSWORD:bank_pass}
    driver-class-name: org.postgresql.Driver
    hikari:
      schema: bank-transaction
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 20000
      idle-timeout: 300000
      max-lifetime: 1200000

  # Liquibase for database migrations
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db.changelog-bank-transaction.xml
    default-schema: public
    liquibase-schema: public

server:
  port: 8081

logging:
  level:
    org.springframework.web.reactive: DEBUG
    org.springframework.http.server.reactive: DEBUG
    org.springframework.http.codec: DEBUG
    reactor.netty.http.server: DEBUG
    mz.bank.transaction.adapter.rest: DEBUG

application:
  identifier: bank-transaction

# Spring Integration Redis configuration
# Provides centralized thread pool and poller configuration for message channels
app:
  integration:
    postgresql:
      trusted-packages:
        - mz
        - java.math
        - org.springframework
        - kotlin.collections
    redis:
      enabled: true
      executor:
        core-pool-size: 10
        max-pool-size: 50
        thread-name-prefix: "message-channel-"
      poller:
        fixed-delay: 100
        max-messages-per-poll: 10

adapters:
  redis:
    stream:
      bank-transaction-events-stream: bank-transaction.event.bank-transactions
      bank-account-events-stream: bank-account.event.bank-accounts
      bank-account-events-consumer-group: bank-transaction-service
      bank-account-events-consumer-name: bank-transaction-consumer
